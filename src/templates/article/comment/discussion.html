<div ng-controller="DiscussionCtrl">
  <h3 class="ph-no-margin-top">
    <inline-editable
      ng-model="discussion.originalAnnotation.title"
      >
    </inline-editable>
    <span class="small">
      #{{discussion.index}}
    </span>
  </h3>
  <a href="#/users/{{discussion.originalAnnotation.author.username}}">
    {{discussion.originalAnnotation.author.displayName}}
  </a>
  started this discussion
  <span am-time-ago="discussion.originalAnnotation.createdAt"></span>
  <span ng-if="discussion.replies.length == 1">
    &middot; {{discussion.replies.length}} reply
  </span>
  <span ng-if="discussion.replies.length > 1">
    &middot; {{discussion.replies.length}} replies
  </span>

  <div ng-if="discussion.originalAnnotation.target">
    <hr>
    <blockquote>
      {{discussion.originalAnnotation.target.text}}
    </blockquote>
  </div>

  <hr>
  <div class="row">
    <div class="col-md-10">
      <ul class="media-list">
        <li class="media">
          <annotation
            content="discussion.originalAnnotation"
            is-article-author="false"
            requires-body="false"
            >
          </annotation>
        </li>

        <li class="media" ng-repeat="reply in discussion.replies">
          <annotation
            content="reply"
            is-article-author="isArticleAuthor(reply.author._id)"
            delete-function="deleteReply"
            requires-body="true"
            >
            <!--ng-if="reply.permissions.read"-->
          </annotation>
        </li>

        <li class="media">
          <ng-include
            src="'templates/article/comment/new-reply.html'"
            ng-if="auth.user"
            >
          </ng-include>
          {{annotation.body}}

          <div
            ng-if="!auth.user"
            class="media-body ph-login-info-block"
            >
            <div class="panel panel-default">
              <div class="panel-body bg-info">
                <a href="{{auth.orcidUrl}}" class="btn btn-primary">
                  Sign in with ORCID
                </a>
                to join this discussion on PaperHub.
              </div>
            </div>
          </div>

        </li>
      </ul>
    </div>

    <div class="col-md-2">
      <ng-include src="'templates/article/comment/sidebar.html'"></ng-include>
    </div>

  </div>
</div>
